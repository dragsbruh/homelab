<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>hearth</title>

        <style>
            @font-face {
                font-family: "Lilex";
                src: url("/lilex.ttf");
            }

            :root {
                --surface: #0b0e14;
                --surface-alt: #161e2d;
                --text: white;
                --blue: #60a5fa;
                --mono: "Lilex", monospace;
            }

            body {
                margin: 0;
                font-family: var(--mono);
                background: var(--surface);
                color: var(--text);
            }

            .container {
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            h1 {
                font-size: 2rem;
                font-weight: bold;
                margin: 0 0 0.5rem 0;
            }

            h2 {
                font-size: 1.4rem;
                margin: 0 0 0.5rem 0;
            }

            a {
                color: inherit;
                text-decoration: none;
            }

            ul {
                list-style: none;
                margin: 0;
                padding: 0;
            }

            .intro,
            .section {
                padding: 0.5rem 1rem;
            }

            .intro-text {
                margin: 0;
                font-size: 0.9rem;
            }

            .link-block {
                display: block;
                padding: 0.5rem 1rem;
                transition:
                    background 0.15s,
                    padding-left 0.15s;
            }

            .link-block:hover {
                background: var(--surface-alt);
                padding-left: 1.5rem;
            }

            .blue {
                color: var(--blue);
            }

            .underline-on-hover:hover {
                text-decoration: underline;
            }

            .item-text {
                margin: 0;
                font-size: 0.85rem;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="intro">
                <h1>hey there!!!</h1>

                <div style="padding: 1rem 0">
                    <p class="intro-text">
                        this is the place where i host mirrors of random stuff
                        (docs and git repos), deployments of my projects and
                        some other fun stuff.
                    </p>

                    <p class="intro-text">this server runs on my old laptop</p>
                </div>

                <a
                    href="https://github.com/dragsbruh/silitime"
                    class="link-block"
                >
                    uptime:
                    <span id="uptime" class="blue underline-on-hover"></span>
                </a>
            </div>

            <div id="sections"></div>
        </div>

        <script>
            const suffix = document.location.host;

            const selfhosted = [
                { url: `https://git.${suffix}`, title: "forgejo" },
            ];

            const resources = [
                {
                    url: `https://ocaml.${suffix}`,
                    title: "ocaml language manual",
                },
                {
                    url: `https://elixir.${suffix}`,
                    title: "elixir language documentation",
                },
                {
                    url: `https://phoenix.${suffix}`,
                    title: "phoenix framework documentation",
                },
                {
                    url: `https://zig.${suffix}`,
                    title: "zig language documentation",
                },
                {
                    url: `https://rwh.${suffix}`,
                    title: "real world haskell by bryan o'sullivan, don stewart, and john goerzen",
                },
                {
                    url: `https://cs3110.${suffix}`,
                    title: "cs3110 ocaml guide by michael r. clarkson",
                },
                {
                    url: `https://books.${suffix}`,
                    title: "other resources as pdfs (includes non tech related topics too)",
                },
            ];

            const sections = [
                { name: "selfhosted stuff", items: selfhosted },
                { name: "developer resources (mirrors)", items: resources },
            ];

            function formatDuration(seconds) {
                const hrs = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = Math.round(seconds % 60);
                return `${hrs}hr ${mins}min ${secs}sec`;
            }

            async function loadUptime() {
                try {
                    const res = await fetch("/silitime");
                    const data = await res.json();

                    const start = Date.now();
                    setInterval(() => {
                        const elapsed = (Date.now() - start) / 1000;
                        const total = data.uptime_secs + elapsed;
                        document.getElementById("uptime").textContent =
                            formatDuration(total);
                    }, 500);
                } catch {
                    document.getElementById("uptime").textContent =
                        "unavailable";
                }
            }

            async function loadForgejo() {
                try {
                    const resp = await fetch(
                        `https://git.${suffix}/api/v1/orgs/mirrors/repos`,
                    );
                    const results = await resp.json();

                    const parsed = results.map((r) => ({
                        title: r.name.toLowerCase(),
                        url: r.html_url,
                        description: r.description?.toLowerCase() ?? "",
                    }));

                    sections.push({
                        name: "hosted git mirrors (forgejo)",
                        items: parsed,
                    });

                    renderSections();
                } catch (err) {
                    console.error("forgejo fetch failed", err);
                }
            }

            function renderSections() {
                const container = document.getElementById("sections");
                container.innerHTML = "";

                sections.forEach((section) => {
                    const block = document.createElement("div");
                    block.className = "section";

                    const header = document.createElement("h2");
                    header.textContent = section.name;
                    block.appendChild(header);

                    const list = document.createElement("ul");

                    section.items.forEach((item) => {
                        const li = document.createElement("li");

                        const link = document.createElement("a");
                        link.href = item.url;
                        link.className = "link-block";

                        link.innerHTML = `
            <p class="blue underline-on-hover item-text">${item.title}</p>
            <p class="item-text">${item.description || ""}</p>
          `;

                        li.appendChild(link);
                        list.appendChild(li);
                    });

                    block.appendChild(list);
                    container.appendChild(block);
                });
            }

            loadUptime();
            loadForgejo();
            renderSections();
        </script>
    </body>
</html>
